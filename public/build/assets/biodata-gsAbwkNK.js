import{$ as a}from"./jquery-BvxTx_lq.js";a.ajaxSetup({headers:{"X-CSRF-TOKEN":a('meta[name="csrf-token"]').attr("content")}});a(function(){h()});function b(t=""){return a.get("/admin/biodata/gettahunakademik",function(e){const i=Array.isArray(e.data)?e.data:[];a("#tahun_akademik").empty().append('<option value="">Pilih Tahun Akademik</option>'),i.forEach(function(s){var r=s.id==t?"selected":"";a("#tahun_akademik").append(`<option value="${s.id}" ${r}>${s.tahun_akademik}</option>`)})})}function _(t=""){return a.get("/admin/getmitra/universitas",function(e){const i=Array.isArray(e.data)?e.data:[];a("#universitas").empty().append('<option value="">Pilih Universitas</option>'),i.forEach(function(s){var r=s.id==t?"selected":"";a("#universitas").append(`<option value="${s.id}" ${r}>${s.nama_mitra}</option>`)})})}function h(){a.ajax({url:"/admin/getbiodatamahasiswa",type:"GET",dataType:"json",success:function(t){const e=t.data,i=e.biodata_mahasiswa;if(console.log("Data biodata mahasiswa diterima:",e),!e||!e.biodata_mahasiswa){console.warn("Data biodata mahasiswa tidak ditemukan:",e);return}a("#user_id").val(i.user_id),a("#nama").val(e.name),a("#nim").val(i.nim),a("#tempat_lahir").val(i.tempat_lahir),a("#tanggal_lahir").val(i.tanggal_lahir),a("#jenis_kelamin").val(i.jenis_kelamin),a("#alamat_ktp").val(i.alamat_ktp),a("#nik").val(i.nik),a("#no_wa").val(i.no_wa),a("#agama").val(i.agama??""),a("#status_pernikahan").val(i.status_pernikahan),a("#jumlah_saudara").val(i.jumlah_saudara),a("#anak_ke").val(i.anak_ke),i.foto?a("#fotoPreview").attr("src","/"+i.foto):a("#fotoPreview").attr("src","/img/default-avatar.jpg");let s=[];e.akademik&&(s.push(b(e.akademik.tahun_akademik_id)),s.push(_(e.akademik.mitra_id)),a("#fakultas").val(e.akademik.fakultas),a("#program_studi").val(e.akademik.program_studi),a("#semester").val(e.akademik.semester),a("#ip_terakhir").val(e.akademik.ip_terakhir),a("#tahun_akademik_id").val(e.akademik.tahun_akademik_id)),e.orangtua&&v(e.orangtua),e.dokumen&&y(e.dokumen),Promise.all(s).then(()=>{console.log("Semua data (termasuk dropdown) sudah siap!"),T()})},error:function(t,e,i){console.error("Gagal ambil data:",i,t.responseText)}})}function g(t){if(!t)return"";let e=t.length%3,i=t.substr(0,e),s=t.substr(e).match(/\d{3}/g);return s&&(i+=(e?".":"")+s.join(".")),"Rp "+i}function v(t){a("#nama_ayah").val(t.nama_ayah),a("#pekerjaan_ayah").val(t.pekerjaan_ayah),a("#pendidikan_ayah").val(t.pendidikan_ayah),a("#penghasilan_ayah").val(g(t.penghasilan_ayah)),a("#nama_ibu").val(t.nama_ibu),a("#pekerjaan_ibu").val(t.pekerjaan_ibu),a("#pendidikan_ibu").val(t.pendidikan_ibu),a("#penghasilan_ibu").val(g(t.penghasilan_ibu)),a("#jumlah_tanggungan").val(t.jumlah_tanggungan),a("#no_wa_ortu").val(t.no_wa_ortu)}function y(t){c("#scan_ktp",t.scan_ktp),c("#scan_kartu_mahasiswa",t.scan_kartu_mahasiswa),c("#scan_kk",t.scan_kk),c("#transkrip_nilai",t.transkrip_nilai),c("#surat_keterangan_aktif",t.surat_keterangan_aktif),c("#foto_profil",t.foto_profil),c("#essay_motivasi",t.essay_motivasi),c("#sertifikat_prestasi",t.sertifikat_prestasi)}const j=["#penghasilan_ibu","#penghasilan_ayah"];j.forEach(t=>{a(document).on("input",t,function(){let e=this.selectionStart,i=a(this).val(),s=i.replace(/[^0-9]/g,""),r=g(s);a(this).val(r);let u=r.length-i.length;this.setSelectionRange(e+u,e+u)})});function c(t,e){const s=a(t).parent();if(s.find(".lihat-file-btn").remove(),e&&e.trim()!==""){const u=`
            <a href="${"/"+e}" target="_blank"
                class="lihat-file-btn inline-flex items-center px-2 py-1 mt-2 text-xs text-white bg-blue-primary rounded-lg hover:bg-blue-600">
                <i class="fas fa-eye mr-1"></i>Lihat File
            </a>
        `;s.append(u)}}function m(t,e="info"){const r=a(`
            <div class="notification flex items-center space-x-3 ${e==="success"?"bg-green-500":e==="error"?"bg-red-500":"bg-blue-500"} text-white px-6 py-4 rounded-xl shadow-lg transform translate-x-full opacity-0 transition-all duration-300 cursor-pointer">
            <i class="fas ${e==="success"?"fa-check-circle":e==="error"?"fa-exclamation-circle":"fa-info-circle"} text-lg"></i>
            <span class="font-medium">${t}</span>
            </div>
            `);a("#notificationWrapper").append(r),setTimeout(()=>{r.removeClass("translate-x-full opacity-0")},100);const u=setTimeout(()=>{r.addClass("translate-x-full opacity-0"),setTimeout(()=>r.remove(),300)},4e3);r.on("click",function(){clearTimeout(u),a(this).addClass("translate-x-full opacity-0"),setTimeout(()=>a(this).remove(),300)})}a("#biodataForm").on("submit",function(t){t.preventDefault();const e={nama:"Nama Lengkap",nik:"NIK",jenis_kelamin:"Jenis Kelamin",tempat_lahir:"Tempat Lahir",tanggal_lahir:"Tanggal Lahir",alamat_ktp:"Alamat KTP",no_wa:"Nomor WhatsApp",agama:"Agama",status_pernikahan:"Status"};let i=[],s=null;for(const[l,n]of Object.entries(e)){const o=a(`[name="${l}"]`);!o.val()||o.val().trim()===""?(i.push(n),o.addClass("border-red-500 bg-red-50"),s||(s=o)):o.removeClass("border-red-500 bg-red-50")}if(i.length>0)return m(`Mohon lengkapi data berikut: <br><ul class="text-left ml-4 list-disc"><li>${i.join("</li><li>")}</li></ul>`,"error"),s&&s.focus(),!1;const r=a("#submit"),u=r.html();r.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);let p=new FormData(this);a.ajax({url:"/admin/biodatamahasiswa",type:"POST",data:p,processData:!1,contentType:!1,headers:{"X-HTTP-Method-Override":"PUT"},dataType:"json",success:function(l){m(l.message,l.status),r.html(u).prop("disabled",!1),h()},error:function(l){if(r.html(u).prop("disabled",!1),l.status===422&&l.responseJSON.errors){let n=l.responseJSON.errors,o=[];for(let d in n)n.hasOwnProperty(d)&&o.push(n[d].join(", "));m(o.join(" | "),"error")}else{let n=l.responseJSON&&l.responseJSON.message?l.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";m(n,"error")}}})});a("#ip_terakhir").on("input",function(){let t=a(this).val(),e=t.split(".");if(parseFloat(e[0])>4){a(this).val(4);return}t.indexOf(".")!==-1&&e[1].length>3&&a(this).val(e[0]+"."+e[1].slice(0,3))});a("#akademikForm").on("submit",function(t){t.preventDefault();const e={universitas:"Universitas / Perguruan Tinggi",tahun_akademik:"Tahun Akademik Aktif",nim:"Nomor Induk Mahasiswa (NIM)",fakultas:"Nama Fakultas",program_studi:"Program Studi",semester:"Semester Saat Ini",ip_terakhir:"Indeks Prestasi (IP) Terakhir"};let i=[],s=null;for(const[n,o]of Object.entries(e)){const d=a(`[name="${n}"]`),f=d.val();!f||f.toString().trim()===""?(i.push(o),d.addClass("border-red-500 bg-red-50"),s||(s=d)):d.removeClass("border-red-500 bg-red-50")}const r=a('[name="ip_terakhir"]');if(r.val()>4||r.val()<0)return m("Nilai IP tidak valid! Harus di antara 0.00 - 4.00","error"),r.addClass("border-red-500 bg-red-50").focus(),!1;if(i.length>0)return m(`Harap isi bidang berikut: <br><ul class="text-left ml-4 list-disc mt-2"><li>${i.join("</li><li>")}</li></ul>`,"error"),s&&s.focus(),!1;const u=a("#submitakademik"),p=u.html();u.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const l=a(this).serialize();a.ajax({url:"/admin/akademikmahasiswa",type:"PUT",data:l,dataType:"json",success:function(n){m(n.message,n.status),u.html(p).prop("disabled",!1),h()},error:function(n){if(u.html(p).prop("disabled",!1),n.status===422&&n.responseJSON.errors){let o=n.responseJSON.errors,d=[];for(let f in o)o.hasOwnProperty(f)&&d.push(o[f].join(", "));m(d.join(" | "),"error")}else{let o=n.responseJSON&&n.responseJSON.message?n.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";m(o,"error")}}})});a("#orangtuaForm").on("submit",function(t){t.preventDefault();const e={nama_ayah:"Nama Lengkap Ayah",pekerjaan_ayah:"Pekerjaan Ayah",pendidikan_ayah:"Pendidikan Ayah",penghasilan_ayah:"Penghasilan Ayah",nama_ibu:"Nama Lengkap Ibu",pekerjaan_ibu:"Pekerjaan Ibu",pendidikan_ibu:"Pendidikan Ibu",penghasilan_ibu:"Penghasilan Ibu",jumlah_tanggungan:"Jumlah Tanggungan",no_wa_ortu:"No. WA Orang Tua"};let i=[],s=null;for(const[n,o]of Object.entries(e)){const d=a(`[name="${n}"]`);!d.val()||d.val().toString().trim()===""?(i.push(o),d.addClass("border-red-500 bg-red-50"),s||(s=d)):d.removeClass("border-red-500 bg-red-50")}if(i.length>0)return m(`Data belum lengkap: <br><ul class="text-left ml-4 list-disc mt-2"><li>${i.join("</li><li>")}</li></ul>`,"error"),s&&s.focus(),!1;const r=a("#submitorangtua"),u=r.html(),p={};a(".rupiah-input").each(function(){p[this.id]=a(this).val();const n=a(this).val().replace(/[^0-9]/g,"");a(this).val(n||0)}),r.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const l=a(this).serialize();a(".rupiah-input").each(function(){a(this).val(p[this.id])}),a.ajax({url:"/admin/orangtuamahasiswa",type:"PUT",data:l,dataType:"json",success:function(n){m(n.message,n.status),r.html(u).prop("disabled",!1),h()},error:function(n){if(r.html(u).prop("disabled",!1),n.status===422&&n.responseJSON.errors){let o=n.responseJSON.errors,d=[];for(let f in o)o.hasOwnProperty(f)&&d.push(o[f].join(", "));m(d.join(" | "),"error")}else{let o=n.responseJSON&&n.responseJSON.message?n.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";m(o,"error")}}})});a('input[type="file"]').on("change",function(){const t=this.files[0],e=500*1024,i=a(this).closest(".space-y-2").find("label").text().trim(),s=a(this).next("div"),r=s.find(".file-name"),u=s.find(".btn-preview");if(t)if(t.size>e)m(`File "${i}" terlalu besar! Maksimal 500 KB.`,"error"),a(this).val(""),r.text("Pilih file...").removeClass("text-orange-600 font-bold"),u.addClass("hidden");else{m(`File "${i}" terpilih.`,"success"),r.text(t.name).addClass("text-orange-600 font-bold"),u.removeClass("hidden");const p=URL.createObjectURL(t);u.off("click").on("click",function(l){l.preventDefault(),l.stopPropagation(),window.open(p,"_blank")})}});a("#dokumenForm").on("submit",function(t){t.preventDefault();const e={scan_ktp:"Scan KTP",scan_kartu_mahasiswa:"Scan Kartu Mahasiswa",scan_kk:"Scan Kartu Keluarga",transkrip_nilai:"Transkrip Nilai",surat_keterangan_aktif:"Surat Keterangan Aktif",foto_profil:"Foto Profil",essay_motivasi:"Essay Motivasi",sertifikat_prestasi:"Sertifikat Prestasi"};let i=[],s=null;for(const[l,n]of Object.entries(e)){const o=a(`#${l}`),d=o.next("div");o[0].files.length===0?(i.push(n),d.addClass("border-red-500 bg-red-50").removeClass("border-gray-200"),s||(s=o)):d.removeClass("border-red-500 bg-red-50").addClass("border-green-500")}if(i.length>0)return m(`Semua dokumen wajib diunggah ulang: <br><ul class="text-left ml-4 list-disc mt-2"><li>${i.join("</li><li>")}</li></ul>`,"error"),s&&a("html, body").animate({scrollTop:s.offset().top-150},500),!1;const r=a("#submitdokumen"),u=r.html();r.html('<i class="fas fa-spinner fa-spin mr-2"></i>Sedang Mengunggah...').prop("disabled",!0);const p=new FormData(this);a.ajax({url:"/admin/dokumenmahasiswa",type:"POST",data:p,processData:!1,contentType:!1,success:function(l){m(l.message,l.status),r.html(u).prop("disabled",!1),h()},error:function(l){if(r.html(u).prop("disabled",!1),l.status===422&&l.responseJSON.errors){let n=l.responseJSON.errors,o=[];for(let d in n)n.hasOwnProperty(d)&&o.push(n[d].join(", "));m(o.join(" | "),"error")}else{let n=l.responseJSON&&l.responseJSON.message?l.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";m(n,"error")}}})});a("#foto").on("change",function(){const t=this.files[0];if(!t)return;const e=new FileReader;e.onload=function(i){a("#fotoPreview").attr("src",i.target.result)},e.readAsDataURL(t)});const k=["biodata","akademik","orangtua","dokumen"];function T(){k.forEach((t,e)=>{const i=k[e+1];if(!i)return;const s=a(`#${t}`),r=a(`[data-tab="${i}"]`);let u=!0;if(s.find('[data-required="true"]').each(function(){if(a(this).attr("type")==="file"){if(this.files.length===0)return u=!1,!1}else{const l=a(this).val();if(!l||l.toString().trim()==="")return u=!1,!1}}),u)r.prop("disabled",!1).removeClass("opacity-50 cursor-not-allowed").addClass("hover:text-blue-primary");else for(let l=e+1;l<k.length;l++)a(`[data-tab="${k[l]}"]`).prop("disabled",!0).addClass("opacity-50 cursor-not-allowed").removeClass("hover:text-blue-primary")})}
