import{$ as e}from"./jquery-BvxTx_lq.js";tailwind.config={theme:{extend:{colors:{"orange-primary":"#FF6B35","orange-light":"#FF8A65","blue-primary":"#1E40AF","blue-light":"#3B82F6"}}}};e.ajaxSetup({headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}});let d=1;const y=10;function M(a){const t=e("#tableBody");if(t.empty(),a.length===0){t.append(`
            <tr>
                <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                    <i class="fas fa-info-circle text-gray-400 mr-2"></i>
                    Tidak ada data ditemukan
                </td>
            </tr>
        `);return}a.forEach((s,o)=>{const n=s.user?.status_user==="Aktif"?"bg-green-100 text-green-800":"bg-red-100 text-red-800",i=`
            <tr class="hover:bg-gray-50 transition-colors duration-200">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${o+1}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10">
                            <div class="h-10 w-10 rounded-full bg-gradient-to-r gradient-bg to-blue-light flex items-center justify-center text-white font-semibold">
                                ${s.user?.name.charAt(0)}
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${s.user?.name}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${s.user?.akademik?.mitra?.nama_mitra||"-"}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${s.user?.email}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${n}">
                        ${s.user?.status_user}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    ${s.user.status_user!=="Tidak Aktif"?`
                            <button class="alumni-btn px-3 py-1 text-blue-600 hover:text-blue-800 transition-all"
                                title="Set Alumni" data-id="${s.user?.id}" data-name="${s.user.name}">
                                <i class="fas fa-user-graduate text-xl"></i>
                            </button>
                        `:`
                            <i class="fas fa-lock text-gray-400 text-xl" title="Aksi tidak tersedia"></i>
                        `}
                </td>
            </tr>
        `;t.append(i)})}function u(a="",t=1){e.ajax({url:"/admin/getpbsaktif",type:"GET",data:{search:a,page:t,limit:y},dataType:"json",success:function(s){const o=s.data;if(!Array.isArray(o)){console.error("Response data bukan array:",o);return}M(o),F(s.last_page,a);let n=(s.current_page-1)*y+1,i=n+o.length-1;e("#resultCount").html(`
                <i class="fas fa-info-circle mr-1"></i>
                Menampilkan ${n} - ${i} dari ${s.total} data
            `)},error:function(s,o,n){console.error("Gagal ambil data:",n,s.responseText)}})}function F(a,t){const s=e("#pagination");if(s.empty(),!(a<=1))for(let o=1;o<=a;o++){const n=e(`<button class="page-btn mx-1 px-3 py-1 rounded-lg border ${o===d?"bg-orange-primary text-white":"bg-white text-gray-700 hover:bg-gray-100"}">${o}</button>`);n.on("click",function(){d=o,u(t,d)}),s.append(n)}}e("#searchInputuser").on("input",function(){const a=e(this).val();d=1,u(a,d)});e(function(){u()});let p=null;function b(a){const t=e("#"+a);t.removeClass("hidden"),setTimeout(()=>{t.find(".modal-content").addClass("show")},10),e("body").addClass("overflow-hidden")}function f(a){const t=e("#"+a);t.find(".modal-content").removeClass("show"),setTimeout(()=>{t.addClass("hidden"),e("body").removeClass("overflow-hidden")},300)}function x(){e("#employeeForm")[0].reset(),e("#employeeForm input, #employeeForm select, #employeeForm textarea").removeClass("border-red-300")}e(document).keydown(function(a){a.keyCode===27&&(e("#employeeModal").hasClass("hidden")?e("#alumniModal").hasClass("hidden")||f("alumniModal"):f("employeeModal"))});function E(){let a=!0;["employeeName","employeeEmail","password"].forEach(function(n){const i=e("#"+n);i.val().trim()?i.removeClass("border-red-300 bg-red-50"):(i.addClass("border-red-300 bg-red-50"),a=!1)});const s=e("#employeeEmail").val();return s&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)&&(e("#employeeEmail").addClass("border-red-300 bg-red-50"),a=!1),a}e("#employeeForm").on("submit",function(a){if(a.preventDefault(),!E()){r("Mohon lengkapi semua field yang wajib diisi!","error");return}const t=e("#submitBtn"),s=t.html();t.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const o=e("#employeeId").val(),n={name:e("#employeeName").val(),email:e("#employeeEmail").val(),password:e("#password").val(),status:e("#employeeStatus").val(),role:e("#employeeRole").val()},i=o?`/user/${o}`:"/user",T=o?"PUT":"POST";e.ajax({url:i,type:T,data:JSON.stringify(n),contentType:"application/json",success:function(l){r(l.message,l.status),c("employeeModal"),t.html(s).prop("disabled",!1),u(e("#searchInputuser").val(),d)},error:function(l){if(t.html(s).prop("disabled",!1),l.status===422&&l.responseJSON.errors){let m=l.responseJSON.errors,g=[];for(let h in m)m.hasOwnProperty(h)&&g.push(m[h].join(", "));r(g.join(" | "),"error")}else{let m=l.responseJSON&&l.responseJSON.message?l.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";r(m,"error")}}})});e("#employeeModal").on("shown",function(){e("#employeeName").focus()});e("#employeeForm input, #employeeForm select, #employeeForm textarea").on("focus",function(){e(this).removeClass("border-red-300 bg-red-50")});e("#employeeEmail").on("blur",function(){const a=e(this).val();a&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?(e(this).addClass("border-red-300 bg-red-50"),v(this,"Format email tidak valid")):(e(this).removeClass("border-red-300 bg-red-50"),w(this))});e("#password").on("blur",function(){const a=e(this).val();a&&a.length<6?(e(this).addClass("border-red-300 bg-red-50"),v(this,"Password harus minimal 6 karakter")):(e(this).removeClass("border-red-300 bg-red-50"),w(this))});function v(a,t){const s=e(a),o=s.attr("id")+"-error";e("#"+o).remove(),s.after(`<div id="${o}" class="text-red-500 text-xs mt-1 animate-pulse"><i class="fas fa-exclamation-circle mr-1"></i>${t}</div>`)}function w(a){const s=e(a).attr("id")+"-error";e("#"+s).remove()}function r(a,t="info"){const n=e(`
        <div class="notification flex items-center space-x-3 ${t==="success"?"bg-green-500":t==="error"?"bg-red-500":"bg-blue-500"} text-white px-6 py-4 rounded-xl shadow-lg transform translate-x-full opacity-0 transition-all duration-300 cursor-pointer">
            <i class="fas ${t==="success"?"fa-check-circle":t==="error"?"fa-exclamation-circle":"fa-info-circle"} text-lg"></i>
            <span class="font-medium">${a}</span>
        </div>
    `);e("#notificationWrapper").append(n),setTimeout(()=>{n.removeClass("translate-x-full opacity-0")},100);const i=setTimeout(()=>{n.addClass("translate-x-full opacity-0"),setTimeout(()=>n.remove(),300)},4e3);n.on("click",function(){clearTimeout(i),e(this).addClass("translate-x-full opacity-0"),setTimeout(()=>e(this).remove(),300)})}function C(){e(window).width()<640?e(".modal-content").addClass("mx-4 max-h-[95vh]"):e(".modal-content").removeClass("mx-4 max-h-[95vh]")}e(window).on("resize",function(){C()});C();function S(){e("body").css({overflow:"hidden","padding-right":"15px"})}function I(){e("body").css({overflow:"","padding-right":""})}function k(a){b(a),S()}function c(a){f(a),I()}function $(a=""){e.get("/admin/menu/getroles",function(t){const s=Array.isArray(t.data)?t.data:[];e("#employeeRole").empty(),e("#employeeRole").append('<option value="">Pilih Role</option>'),s.forEach(function(o){var n=o.id==a?"selected":"";e("#employeeRole").append(`<option value="${o.id}" ${n}>${o.name}</option>`)})}).fail(function(){alert("Gagal mengambil data role. Pastikan API berjalan dengan benar.")})}e("#addEmployeeBtn").on("click",function(){p=null,x(),e("#modalTitle").text("Tambah User Baru"),e("#modalIcon").removeClass("fa-edit").addClass("fa-user-plus"),e("#submitText").text("Simpan Data"),e("#submitIcon").removeClass("fa-edit").addClass("fa-save"),$(),k("employeeModal")});e(document).on("click",".edit-btn",function(){p=e(this).data("id"),x(),e("#modalTitle").text("Edit Data User"),e("#modalIcon").removeClass("fa-user-plus").addClass("fa-edit"),e("#submitText").text("Update Data"),e("#submitIcon").removeClass("fa-save").addClass("fa-edit"),e.ajax({url:"/admin/user/"+p,type:"GET",success:function(a){e("#employeeId").val(a.id),e("#employeeName").val(a.name),e("#employeeEmail").val(a.email),e("#employeeStatus").val(a.status_user),$(a.role),e("#employeeJoinDate").val(a.join_date||""),e("#employeeSalary").val(a.salary||""),e("#employeeAddress").val(a.address||""),b("employeeModal")},error:function(a){console.error("Gagal ambil data:",a.responseText),alert("Gagal ambil data user")}})});e("#closeModal, #cancelBtn").on("click",function(){c("employeeModal")});e("#cancelAlumniBtn").on("click",function(){c("alumniModal")});e(".modal-overlay").on("click",function(a){a.target===this&&(e(this).closest("#employeeModal").length?c("employeeModal"):e(this).closest("#alumniModal").length&&c("alumniModal"))});e(document).on("click",".alumni-btn",function(){const a=e(this).data("id"),t=e(this).data("name");e("#alumniUserId").val(a),e("#alumniUserName").text(t),k("alumniModal")});e(document).on("click","#confirmAlumniBtn",function(){const a=e(this),t=a.html();a.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const s=e("#alumniUserId").val();e.ajax({url:`/admin/confirmalumni/${s}`,type:"PUT",success:function(o){r(o.message,o.status),c("alumniModal"),u()},error:function(o){let n=o.responseJSON&&o.responseJSON.message?o.responseJSON.message:"Gagal menyimpan data!";r(n,"error")},complete:function(){a.html(t).prop("disabled",!1)}})});
