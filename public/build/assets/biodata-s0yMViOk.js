import{$ as a}from"./jquery-BvxTx_lq.js";a.ajaxSetup({headers:{"X-CSRF-TOKEN":a('meta[name="csrf-token"]').attr("content")}});a(function(){p()});function h(t=""){return a.get("/admin/biodata/gettahunakademik",function(e){const i=Array.isArray(e.data)?e.data:[];a("#tahun_akademik").empty().append('<option value="">Pilih Tahun Akademik</option>'),i.forEach(function(o){var s=o.id==t?"selected":"";a("#tahun_akademik").append(`<option value="${o.id}" ${s}>${o.tahun_akademik}</option>`)})})}function k(t=""){return a.get("/admin/getmitra",function(e){const i=Array.isArray(e.data)?e.data:[];a("#universitas").empty().append('<option value="">Pilih Universitas</option>'),i.forEach(function(o){var s=o.id==t?"selected":"";a("#universitas").append(`<option value="${o.id}" ${s}>${o.nama_mitra}</option>`)})})}function p(){a.ajax({url:"/admin/getbiodatamahasiswa",type:"GET",dataType:"json",success:function(t){const e=t.data,i=e.biodata_mahasiswa;if(console.log("Data biodata mahasiswa diterima:",e),!e||!e.biodata_mahasiswa){console.warn("Data biodata mahasiswa tidak ditemukan:",e);return}a("#user_id").val(i.user_id),a("#nama").val(e.name),a("#nim").val(i.nim),a("#tempat_lahir").val(i.tempat_lahir),a("#tanggal_lahir").val(i.tanggal_lahir),a("#jenis_kelamin").val(i.jenis_kelamin),a("#alamat_ktp").val(i.alamat_ktp),a("#nik").val(i.nik),a("#no_wa").val(i.no_wa),a("#agama").val(i.agama??""),a("#status_pernikahan").val(i.status_pernikahan),a("#jumlah_saudara").val(i.jumlah_saudara),a("#anak_ke").val(i.anak_ke),i.foto?a("#fotoPreview").attr("src","/"+i.foto):a("#fotoPreview").attr("src","/img/default-avatar.jpg");let o=[];e.akademik&&(o.push(h(e.akademik.tahun_akademik_id)),o.push(k(e.akademik.mitra_id)),a("#fakultas").val(e.akademik.fakultas),a("#program_studi").val(e.akademik.program_studi),a("#semester").val(e.akademik.semester),a("#ip_terakhir").val(e.akademik.ip_terakhir),a("#tahun_akademik_id").val(e.akademik.tahun_akademik_id)),e.orangtua&&g(e.orangtua),e.dokumen&&_(e.dokumen),Promise.all(o).then(()=>{console.log("Semua data (termasuk dropdown) sudah siap!"),v()})},error:function(t,e,i){console.error("Gagal ambil data:",i,t.responseText)}})}function c(t){if(!t)return"";let e=t.length%3,i=t.substr(0,e),o=t.substr(e).match(/\d{3}/g);return o&&(i+=(e?".":"")+o.join(".")),"Rp "+i}function g(t){a("#nama_ayah").val(t.nama_ayah),a("#pekerjaan_ayah").val(t.pekerjaan_ayah),a("#pendidikan_ayah").val(t.pendidikan_ayah),a("#penghasilan_ayah").val(c(t.penghasilan_ayah)),a("#nama_ibu").val(t.nama_ibu),a("#pekerjaan_ibu").val(t.pekerjaan_ibu),a("#pendidikan_ibu").val(t.pendidikan_ibu),a("#penghasilan_ibu").val(c(t.penghasilan_ibu)),a("#jumlah_tanggungan").val(t.jumlah_tanggungan),a("#no_wa_ortu").val(t.no_wa_ortu)}function _(t){m("#scan_ktp",t.scan_ktp),m("#scan_kartu_mahasiswa",t.scan_kartu_mahasiswa),m("#scan_kk",t.scan_kk),m("#transkrip_nilai",t.transkrip_nilai),m("#surat_keterangan_aktif",t.surat_keterangan_aktif),m("#foto_profil",t.foto_profil),m("#essay_motivasi",t.essay_motivasi),m("#sertifikat_prestasi",t.sertifikat_prestasi)}const b=["#penghasilan_ibu","#penghasilan_ayah"];b.forEach(t=>{a(document).on("input",t,function(){let e=this.selectionStart,i=a(this).val(),o=i.replace(/[^0-9]/g,""),s=c(o);a(this).val(s);let n=s.length-i.length;this.setSelectionRange(e+n,e+n)})});function m(t,e){const o=a(t).parent();if(o.find(".lihat-file-btn").remove(),e&&e.trim()!==""){const n=`
            <a href="${"/"+e}" target="_blank"
                class="lihat-file-btn inline-flex items-center px-2 py-1 mt-2 text-xs text-white bg-blue-primary rounded-lg hover:bg-blue-600">
                <i class="fas fa-eye mr-1"></i>Lihat File
            </a>
        `;o.append(n)}}function u(t,e="info"){const s=a(`
            <div class="notification flex items-center space-x-3 ${e==="success"?"bg-green-500":e==="error"?"bg-red-500":"bg-blue-500"} text-white px-6 py-4 rounded-xl shadow-lg transform translate-x-full opacity-0 transition-all duration-300 cursor-pointer">
            <i class="fas ${e==="success"?"fa-check-circle":e==="error"?"fa-exclamation-circle":"fa-info-circle"} text-lg"></i>
            <span class="font-medium">${t}</span>
            </div>
            `);a("#notificationWrapper").append(s),setTimeout(()=>{s.removeClass("translate-x-full opacity-0")},100);const n=setTimeout(()=>{s.addClass("translate-x-full opacity-0"),setTimeout(()=>s.remove(),300)},4e3);s.on("click",function(){clearTimeout(n),a(this).addClass("translate-x-full opacity-0"),setTimeout(()=>a(this).remove(),300)})}a("#biodataForm").on("submit",function(t){t.preventDefault();const e=a("#submit"),i=e.html();e.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);let o=new FormData(this);a.ajax({url:"/admin/biodatamahasiswa",type:"POST",data:o,processData:!1,contentType:!1,headers:{"X-HTTP-Method-Override":"PUT"},dataType:"json",success:function(s){u(s.message,s.status),e.html(i).prop("disabled",!1),p()},error:function(s){if(e.html(i).prop("disabled",!1),s.status===422&&s.responseJSON.errors){let n=s.responseJSON.errors,l=[];for(let r in n)n.hasOwnProperty(r)&&l.push(n[r].join(", "));u(l.join(" | "),"error")}else{let n=s.responseJSON&&s.responseJSON.message?s.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(n,"error")}}})});a("#ip_terakhir").on("input",function(){let t=a(this).val(),e=t.split(".");if(parseFloat(e[0])>4){a(this).val(4);return}t.indexOf(".")!==-1&&e[1].length>3&&a(this).val(e[0]+"."+e[1].slice(0,3))});a("#akademikForm").on("submit",function(t){t.preventDefault();const e=a("#submitakademik"),i=e.html();e.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const o=a(this).serialize();a.ajax({url:"/admin/akademikmahasiswa",type:"PUT",data:o,dataType:"json",success:function(s){u(s.message,s.status),e.html(i).prop("disabled",!1),p()},error:function(s){if(e.html(i).prop("disabled",!1),s.status===422&&s.responseJSON.errors){let n=s.responseJSON.errors,l=[];for(let r in n)n.hasOwnProperty(r)&&l.push(n[r].join(", "));u(l.join(" | "),"error")}else{let n=s.responseJSON&&s.responseJSON.message?s.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(n,"error")}}})});a("#orangtuaForm").on("submit",function(t){t.preventDefault();const e=a("#submitorangtua"),i=e.html();e.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const o={};a(".rupiah-input").each(function(){const n=a(this).val().replace(/[^0-9]/g,"");a(this).val(n||0)});const s=a(this).serialize();a(".rupiah-input").each(function(){a(this).val(o[this.id])}),a.ajax({url:"/admin/orangtuamahasiswa",type:"PUT",data:s,dataType:"json",success:function(n){u(n.message,n.status),e.html(i).prop("disabled",!1),p()},error:function(n){if(e.html(i).prop("disabled",!1),n.status===422&&n.responseJSON.errors){let l=n.responseJSON.errors,r=[];for(let f in l)l.hasOwnProperty(f)&&r.push(l[f].join(", "));u(r.join(" | "),"error")}else{let l=n.responseJSON&&n.responseJSON.message?n.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(l,"error")}}})});a('input[type="file"]').on("change",function(){const t=this.files[0],e=500*1024,i=a(this).closest(".space-y-2").find("label").text().trim(),o=a(this).next("div"),s=o.find(".file-name"),n=o.find(".btn-preview");if(t)if(t.size>e)u(`File "${i}" terlalu besar! Maksimal 500 KB.`,"error"),a(this).val(""),s.text("Pilih file...").removeClass("text-orange-600 font-bold"),n.addClass("hidden");else{u(`File "${i}" terpilih.`,"success"),s.text(t.name).addClass("text-orange-600 font-bold"),n.removeClass("hidden");const l=URL.createObjectURL(t);n.off("click").on("click",function(r){r.preventDefault(),r.stopPropagation(),window.open(l,"_blank")})}});a("#dokumenForm").on("submit",function(t){t.preventDefault();const e=a("#submitdokumen"),i=e.html();e.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const o=new FormData(this);a.ajax({url:"/admin/dokumenmahasiswa",type:"POST",data:o,processData:!1,contentType:!1,success:function(s){u(s.message,s.status),e.html(i).prop("disabled",!1),p()},error:function(s){if(e.html(i).prop("disabled",!1),s.status===422&&s.responseJSON.errors){let n=s.responseJSON.errors,l=[];for(let r in n)n.hasOwnProperty(r)&&l.push(n[r].join(", "));u(l.join(" | "),"error")}else{let n=s.responseJSON&&s.responseJSON.message?s.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(n,"error")}}})});a("#foto").on("change",function(){const t=this.files[0];if(!t)return;const e=new FileReader;e.onload=function(i){a("#fotoPreview").attr("src",i.target.result)},e.readAsDataURL(t)});const d=["biodata","akademik","orangtua","dokumen"];function v(){d.forEach((t,e)=>{const i=d[e+1];if(!i)return;const o=a(`#${t}`),s=a(`[data-tab="${i}"]`);let n=!0;if(o.find('[required]:not([type="file"])').each(function(){const r=a(this).val();if(!r||r.toString().trim()==="")return n=!1,console.warn(`Validation: Field ${a(this).attr("name")} masih kosong.`),!1}),n)console.log(`âœ… Tab ${t} lengkap, membuka tab ${i}`),s.prop("disabled",!1).removeClass("opacity-50 cursor-not-allowed").addClass("hover:text-blue-primary");else for(let r=e+1;r<d.length;r++)a(`[data-tab="${d[r]}"]`).prop("disabled",!0).addClass("opacity-50 cursor-not-allowed").removeClass("hover:text-blue-primary")})}
