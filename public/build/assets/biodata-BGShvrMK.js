import{$ as a}from"./jquery-BvxTx_lq.js";a.ajaxSetup({headers:{"X-CSRF-TOKEN":a('meta[name="csrf-token"]').attr("content")}});a(function(){p()});function d(t=""){a.get("/admin/biodata/gettahunakademik",function(e){const i=Array.isArray(e.data)?e.data:[];a("#tahun_akademik").empty(),a("#tahun_akademik").append('<option value="">Pilih Tahun Akademik</option>'),i.forEach(function(r){var s=r.id==t?"selected":"";a("#tahun_akademik").append(`<option value="${r.id}" ${s}>${r.tahun_akademik}</option>`)})}).fail(function(){alert("Gagal mengambil data tahun akademik. Pastikan API berjalan dengan benar.")})}function h(t=""){a.get("/admin/biodata/getmitra",function(e){const i=Array.isArray(e.data)?e.data:[];a("#universitas").empty(),a("#universitas").append('<option value="">Pilih Universitas</option>'),i.forEach(function(r){var s=r.id==t?"selected":"";a("#universitas").append(`<option value="${r.id}" ${s}>${r.nama_mitra}</option>`)})}).fail(function(){alert("Gagal mengambil data tahun akademik. Pastikan API berjalan dengan benar.")})}function p(){a.ajax({url:"/admin/getbiodatamahasiswa",type:"GET",dataType:"json",success:function(t){const e=t.data;if(console.log("Data biodata mahasiswa diterima:",e),!e||!e.biodata_mahasiswa){console.warn("Data biodata mahasiswa tidak ditemukan:",e);return}const i=e.biodata_mahasiswa;a("#user_id").val(i.user_id),a("#nama").val(e.name),a("#nim").val(i.nim),a("#tempat_lahir").val(i.tempat_lahir),a("#tanggal_lahir").val(i.tanggal_lahir),a("#jenis_kelamin").val(i.jenis_kelamin),a("#alamat_ktp").val(i.alamat_ktp),a("#nik").val(i.nik),a("#no_wa").val(i.no_wa),a("#agama").val(i.agama),a("#status_pernikahan").val(i.status_pernikahan),a("#jumlah_saudara").val(i.jumlah_saudara),a("#anak_ke").val(i.anak_ke),i.foto?a("#fotoPreview").attr("src","/"+i.foto):a("#fotoPreview").attr("src","/img/default-avatar.jpg"),e.akademik&&g(e.akademik),e.orangtua&&_(e.orangtua),e.dokumen&&b(e.dokumen)},error:function(t,e,i){console.error("Gagal ambil data:",i,t.responseText)}})}const k=["#penghasilan_ibu","#penghasilan_ayah"];k.forEach(t=>{a(document).on("input",t,function(){let e=this.selectionStart,i=a(this).val(),r=i.replace(/[^0-9]/g,""),s=c(r);a(this).val(s);let n=s.length-i.length;this.setSelectionRange(e+n,e+n)})});function c(t){if(!t)return"";let e=t.length%3,i=t.substr(0,e),r=t.substr(e).match(/\d{3}/g);return r&&(i+=(e?".":"")+r.join(".")),"Rp "+i}function g(t){a("#fakultas").val(t.fakultas),a("#program_studi").val(t.program_studi),a("#semester").val(t.semester),a("#ip_terakhir").val(t.ip_terakhir),a("#tahun_akademik_id").val(t.tahun_akademik_id),d(t.tahun_akademik_id),h(t.mitra_id)}function _(t){a("#nama_ayah").val(t.nama_ayah),a("#pekerjaan_ayah").val(t.pekerjaan_ayah),a("#pendidikan_ayah").val(t.pendidikan_ayah),a("#penghasilan_ayah").val(c(t.penghasilan_ayah)),a("#nama_ibu").val(t.nama_ibu),a("#pekerjaan_ibu").val(t.pekerjaan_ibu),a("#pendidikan_ibu").val(t.pendidikan_ibu),a("#penghasilan_ibu").val(c(t.penghasilan_ibu)),a("#jumlah_tanggungan").val(t.jumlah_tanggungan),a("#no_wa_ortu").val(t.no_wa_ortu)}function b(t){m("#scan_ktp",t.scan_ktp),m("#scan_kartu_mahasiswa",t.scan_kartu_mahasiswa),m("#scan_kk",t.scan_kk),m("#transkrip_nilai",t.transkrip_nilai),m("#surat_keterangan_aktif",t.surat_keterangan_aktif),m("#foto_profil",t.foto_profil),m("#essay_motivasi",t.essay_motivasi),m("#sertifikat_prestasi",t.sertifikat_prestasi)}function m(t,e){const r=a(t).parent();if(r.find(".lihat-file-btn").remove(),e&&e.trim()!==""){const n=`
            <a href="${"/"+e}" target="_blank"
                class="lihat-file-btn inline-flex items-center px-2 py-1 mt-2 text-xs text-white bg-blue-primary rounded-lg hover:bg-blue-600">
                <i class="fas fa-eye mr-1"></i>Lihat File
            </a>
        `;r.append(n)}}function l(t,e="info"){const s=a(`
            <div class="notification flex items-center space-x-3 ${e==="success"?"bg-green-500":e==="error"?"bg-red-500":"bg-blue-500"} text-white px-6 py-4 rounded-xl shadow-lg transform translate-x-full opacity-0 transition-all duration-300 cursor-pointer">
            <i class="fas ${e==="success"?"fa-check-circle":e==="error"?"fa-exclamation-circle":"fa-info-circle"} text-lg"></i>
            <span class="font-medium">${t}</span>
            </div>
            `);a("#notificationWrapper").append(s),setTimeout(()=>{s.removeClass("translate-x-full opacity-0")},100);const n=setTimeout(()=>{s.addClass("translate-x-full opacity-0"),setTimeout(()=>s.remove(),300)},4e3);s.on("click",function(){clearTimeout(n),a(this).addClass("translate-x-full opacity-0"),setTimeout(()=>a(this).remove(),300)})}a("#biodataForm").on("submit",function(t){t.preventDefault();const e=a("#submit"),i=e.html();e.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);let r=new FormData(this);a.ajax({url:"/admin/biodatamahasiswa",type:"POST",data:r,processData:!1,contentType:!1,headers:{"X-HTTP-Method-Override":"PUT"},dataType:"json",success:function(s){l(s.message,s.status),e.html(i).prop("disabled",!1),p()},error:function(s){if(e.html(i).prop("disabled",!1),s.status===422&&s.responseJSON.errors){let n=s.responseJSON.errors,o=[];for(let u in n)n.hasOwnProperty(u)&&o.push(n[u].join(", "));l(o.join(" | "),"error")}else{let n=s.responseJSON&&s.responseJSON.message?s.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";l(n,"error")}}})});a("#ip_terakhir").on("input",function(){let t=a(this).val(),e=t.split(".");if(parseFloat(e[0])>4){a(this).val(4);return}t.indexOf(".")!==-1&&e[1].length>3&&a(this).val(e[0]+"."+e[1].slice(0,3))});a("#akademikForm").on("submit",function(t){t.preventDefault();const e=a("#submitakademik"),i=e.html();e.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const r=a(this).serialize();a.ajax({url:"/admin/akademikmahasiswa",type:"PUT",data:r,dataType:"json",success:function(s){l(s.message,s.status),e.html(i).prop("disabled",!1),p()},error:function(s){if(e.html(i).prop("disabled",!1),s.status===422&&s.responseJSON.errors){let n=s.responseJSON.errors,o=[];for(let u in n)n.hasOwnProperty(u)&&o.push(n[u].join(", "));l(o.join(" | "),"error")}else{let n=s.responseJSON&&s.responseJSON.message?s.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";l(n,"error")}}})});a("#orangtuaForm").on("submit",function(t){t.preventDefault();const e=a("#submitorangtua"),i=e.html();e.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const r={};a(".rupiah-input").each(function(){const n=a(this).val().replace(/[^0-9]/g,"");a(this).val(n||0)});const s=a(this).serialize();a(".rupiah-input").each(function(){a(this).val(r[this.id])}),a.ajax({url:"/admin/orangtuamahasiswa",type:"PUT",data:s,dataType:"json",success:function(n){l(n.message,n.status),e.html(i).prop("disabled",!1),p()},error:function(n){if(e.html(i).prop("disabled",!1),n.status===422&&n.responseJSON.errors){let o=n.responseJSON.errors,u=[];for(let f in o)o.hasOwnProperty(f)&&u.push(o[f].join(", "));l(u.join(" | "),"error")}else{let o=n.responseJSON&&n.responseJSON.message?n.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";l(o,"error")}}})});a('input[type="file"]').on("change",function(){const t=this.files[0],e=500*1024,i=a(this).closest(".space-y-2").find("label").text().trim();t&&(t.size>e?(l(`File "${i}" terlalu besar! Maksimal 500 KB.`,"error"),a(this).val("")):l(`File "${i}" terpilih.`,"success"))});a("#dokumenForm").on("submit",function(t){t.preventDefault();const e=a("#submitdokumen"),i=e.html();e.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const r=new FormData(this);a.ajax({url:"/admin/dokumenmahasiswa",type:"POST",data:r,processData:!1,contentType:!1,success:function(s){l(s.message,s.status),e.html(i).prop("disabled",!1),p()},error:function(s){if(e.html(i).prop("disabled",!1),s.status===422&&s.responseJSON.errors){let n=s.responseJSON.errors,o=[];for(let u in n)n.hasOwnProperty(u)&&o.push(n[u].join(", "));l(o.join(" | "),"error")}else{let n=s.responseJSON&&s.responseJSON.message?s.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";l(n,"error")}}})});a("#foto").on("change",function(){const t=this.files[0];if(!t)return;const e=new FileReader;e.onload=function(i){a("#fotoPreview").attr("src",i.target.result)},e.readAsDataURL(t)});
