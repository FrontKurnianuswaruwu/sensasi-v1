import{$ as e}from"./jquery-BvxTx_lq.js";e.ajaxSetup({headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}});e(function(){g()});let r=1;const h=10;function T(t){const s=e("#tableKategorisoal");if(s.empty(),t.length===0){s.append(`
            <tr>
                <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                    <i class="fas fa-info-circle text-gray-400 mr-2"></i>
                    Tidak ada data ditemukan
                </td>
            </tr>
        `);return}const n=t.some(a=>a.hasil_ujians&&a.hasil_ujians.length>0&&a.hasil_ujians[0].status==="selesai");t.forEach((a,i)=>{const c=CURRENT_USER_ID,p=CURRENT_USER_ROLE;let o=!1;a.hasil_ujians&&a.hasil_ujians.length>0&&(p==9?o=a.hasil_ujians[0].status==="selesai":o=a.hasil_ujians.some(x=>x.mahasiswa_id===c&&x.status==="selesai"));let l="",d="";o?(l='<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full"><i class="fas fa-check-circle mr-1"></i> Selesai </span>',d='<span class="inline-flex items-center gap-2 px-4 py-2 bg-gray-300 text-gray-600 rounded-lg cursor-not-allowed" title="Anda sudah menyelesaikan kategori ini"><i class="fas fa-lock"></i> Terkunci</span>'):n?(l='<span class="px-2 py-1 bg-gray-100 text-gray-500 text-xs font-semibold rounded-full"><i class="fas fa-lock mr-1"></i> Terkunci</span>',d='<span class="inline-flex items-center gap-2 px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed" title="Kategori terkunci karena sudah menyelesaikan kategori lain"><i class="fas fa-lock"></i> Terkunci</span>'):a.is_active==1?(l='<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full"><i class="fas fa-play-circle mr-1"></i> Aktif</span>',d=`<a href="/admin/potensiakademik/soal?kategori_id=${a.id}" class="inline-flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all" title="Kerjakan soal kategori ${a.name}"><i class="fas fa-play"></i> Kerjakan</a>`):(l='<span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded-full"><i class="fas fa-ban mr-1"></i> Tidak Aktif</span>',d='<span class="inline-flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-500 rounded-lg cursor-not-allowed"><i class="fas fa-ban"></i> Tidak tersedia</span>');const m=`
            <tr class="hover:bg-gray-50 transition-colors duration-200">
                <td class="px-6 py-4 text-sm text-gray-900">${i+1}</td>
                <td class="px-6 py-4 text-sm font-medium text-gray-900">${a.name}</td>
                <td class="px-6 py-4 text-sm text-gray-900">${a.waktu_pengerjaan} menit</td>
                <td class="px-6 py-4 text-sm">${l}</td>
                <td class="px-6 py-4 text-sm">${d}</td>
            </tr>
        `;s.append(m)})}function w(t){const s=e("#cardContainer");if(s.empty(),t.length===0){s.append(`
            <div class="p-6 text-center text-gray-500">
                <i class="fas fa-info-circle text-gray-400 mr-2"></i>
                Tidak ada data ditemukan
            </div>
        `);return}t.forEach(n=>{const a=`
            <div class="p-4 border-b border-gray-200 hover:bg-gray-50 transition-colors duration-200">
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0 h-12 w-12 rounded-full bg-gradient-to-r gradient-bg to-blue-light flex items-center justify-center text-white font-semibold text-lg">
                        ${n.name.charAt(0)}
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-lg font-semibold text-gray-900 truncate mb-2">${n.name}</h3>
                        <div class="flex mt-4 space-x-2">
                            <button class="edit-btn flex-1 px-3 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-all" data-id="${n.id}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="delete-btn flex-1 px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all" data-id="${n.id}" data-name="${n.name}">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;s.append(a)})}function C(t,s){const n=e("#pagination");if(n.empty(),!(t<=1))for(let a=1;a<=t;a++){const i=e(`<button class="page-btn mx-1 px-3 py-1 rounded-lg border ${a===r?"bg-orange-primary text-white":"bg-white text-gray-700 hover:bg-gray-100"}">${a}</button>`);i.on("click",function(){r=a,g(s,r)}),n.append(i)}}function $(t,s){const n=e("#paginationMobile");if(n.empty(),!(t<=1))for(let a=1;a<=t;a++){const i=e(`<button class="px-3 py-1 rounded-lg border ${a===r?"bg-orange-primary text-white":"bg-white text-gray-700 hover:bg-gray-100"}">${a}</button>`);i.on("click",function(){r=a,g(s,r)}),n.append(i)}}function g(t="",s=1){e.ajax({url:"/admin/getkategoripotensiakademik",type:"GET",data:{search:t,page:s,limit:h},dataType:"json",success:function(n){const a=n.data;if(!Array.isArray(a)){console.error("Response data bukan array:",a);return}T(a),w(a),C(n.last_page,t),$(n.last_page,t);let i=(n.current_page-1)*h+1,c=i+a.length-1;e("#resultCount").html(`
                <i class="fas fa-info-circle mr-1"></i>
                Menampilkan ${i} - ${c} dari ${n.total} data
            `)},error:function(n,a,i){console.error("Gagal ambil data:",i,n.responseText)}})}e("#searchInputkategorisoal").on("input",function(){const t=e(this).val();r=1,g(t,r)});function y(){e("#kategorisoalForm")[0].reset(),e("#kategorisoalForm input, #kategorisoalForm select, #kategorisoalForm textarea").removeClass("border-red-300 bg-red-50")}function k(t){v(t),j()}function j(){e("body").css({overflow:"hidden","padding-right":""})}function v(t){const s=e("#"+t);s.removeClass("hidden"),setTimeout(()=>{s.find(".modal-content").addClass("show")},10),e("body").addClass("overflow-hidden")}function M(){e("body").css({overflow:"","padding-right":""})}e("#closeModal, #cancelBtn").on("click",function(){f("kategorisoalModal")});function f(t){S(t),M()}function S(t){const s=e("#"+t);s.find(".modal-content").removeClass("show"),setTimeout(()=>{s.addClass("hidden"),e("body").removeClass("overflow-hidden")},300)}e(".modal-overlay").on("click",function(t){t.target===this&&(e(this).closest("#kategorisoalModal").length?f("kategorisoalModal"):e(this).closest("#deleteModal").length&&f("deleteModal"))});e("#cancelDeleteBtn").on("click",function(){f("deleteModal")});let b=null;e("#addKategorisoalBtn").on("click",function(){b=null,y(),e("#kategorisoalId").val(""),e("#modalTitle").text("Tambah Kategori Baru"),e("#modalIcon").removeClass("fa-edit").addClass("fa-layer-group"),e("#submitText").text("Simpan Data"),e("#submitIcon").removeClass("fa-edit").addClass("fa-save"),k("kategorisoalModal")});function _(){let t=!0;return["kategorisoalName"].forEach(function(n){const a=e("#"+n);a.val().trim()?a.removeClass("border-red-300 bg-red-50"):(a.addClass("border-red-300 bg-red-50"),t=!1)}),t}function u(t,s="info"){const i=e(`
            <div class="notification flex items-center space-x-3 ${s==="success"?"bg-green-500":s==="error"?"bg-red-500":"bg-blue-500"} text-white px-6 py-4 rounded-xl shadow-lg transform translate-x-full opacity-0 transition-all duration-300 cursor-pointer">
            <i class="fas ${s==="success"?"fa-check-circle":s==="error"?"fa-exclamation-circle":"fa-info-circle"} text-lg"></i>
            <span class="font-medium">${t}</span>
            </div>
            `);e("#notificationWrapper").append(i),setTimeout(()=>{i.removeClass("translate-x-full opacity-0")},100);const c=setTimeout(()=>{i.addClass("translate-x-full opacity-0"),setTimeout(()=>i.remove(),300)},4e3);i.on("click",function(){clearTimeout(c),e(this).addClass("translate-x-full opacity-0"),setTimeout(()=>e(this).remove(),300)})}e("#kategorisoalForm").on("submit",function(t){if(t.preventDefault(),!_()){u("Mohon lengkapi semua field yang wajib diisi!","error");return}const s=e("#submitBtn"),n=s.html();s.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const a=e("#kategorisoalId").val(),i={name:e("#kategorisoalName").val(),waktu_pengerjaan:e("#kategorisoalWaktu").val(),is_active:e("#kategorisoalStatus").val()},c=a?`/admin/kategorisoal/${a}`:"/admin/kategorisoal",p=a?"PUT":"POST";e.ajax({url:c,type:p,data:JSON.stringify(i),contentType:"application/json",success:function(o){u(o.message,o.status),f("kategorisoalModal"),s.html(n).prop("disabled",!1),g(e("#searchInputkategorisoal").val(),r)},error:function(o){if(s.html(n).prop("disabled",!1),o.status===422&&o.responseJSON.errors){let l=o.responseJSON.errors,d=[];for(let m in l)l.hasOwnProperty(m)&&d.push(l[m].join(", "));u(d.join(" | "),"error")}else{let l=o.responseJSON&&o.responseJSON.message?o.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(l,"error")}}})});e(document).on("click",".edit-btn",function(){b=e(this).data("id"),y(),e("#modalTitle").text("Edit Data Tahun akademik"),e("#modalIcon").removeClass("fa-calendar").addClass("fa-edit"),e("#submitText").text("Update Data"),e("#submitIcon").removeClass("fa-save").addClass("fa-edit"),e.ajax({url:"/admin/kategorisoal/"+b,type:"GET",success:function(t){e("#kategorisoalId").val(t.id),e("#kategorisoalName").val(t.name),e("#kategorisoalWaktu").val(t.waktu_pengerjaan),e("#kategorisoalStatus").val(t.is_active?"1":"0"),v("kategorisoalModal")},error:function(t){console.error("Gagal ambil data:",t.responseText),alert("Gagal ambil data kategorisoal")}})});e(document).on("click",".delete-btn",function(){const t=e(this).data("id"),s=e(this).data("name");e("#deletekategorisoalId").val(t),e("#deleteKategorisoalName").text(s),k("deleteModal")});e(document).on("click","#confirmDeleteBtn",function(){const t=e(this),s=t.html();t.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menghapus...').prop("disabled",!0);const n=e("#deletekategorisoalId").val();e.ajax({url:`/admin/kategorisoal/${n}`,type:"DELETE",success:function(a){u(a.message,a.status),f("deleteModal"),g()},error:function(a){let i=a.responseJSON&&a.responseJSON.message?a.responseJSON.message:"Gagal menghapus data!";u(i,"error")},complete:function(){t.html(s).prop("disabled",!1)}})});
