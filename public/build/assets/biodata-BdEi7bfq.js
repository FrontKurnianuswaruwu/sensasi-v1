import{$ as a}from"./jquery-BvxTx_lq.js";a.ajaxSetup({headers:{"X-CSRF-TOKEN":a('meta[name="csrf-token"]').attr("content")}});a(function(){p()});function d(e=""){a.get("/admin/biodata/gettahunakademik",function(t){const s=Array.isArray(t.data)?t.data:[];a("#tahun_akademik").empty(),a("#tahun_akademik").append('<option value="">Pilih Tahun Akademik</option>'),s.forEach(function(r){var i=r.id==e?"selected":"";a("#tahun_akademik").append(`<option value="${r.id}" ${i}>${r.tahun_akademik}</option>`)})}).fail(function(){alert("Gagal mengambil data tahun akademik. Pastikan API berjalan dengan benar.")})}function h(e=""){a.get("/admin/biodata/getmitra",function(t){const s=Array.isArray(t.data)?t.data:[];a("#universitas").empty(),a("#universitas").append('<option value="">Pilih Universitas</option>'),s.forEach(function(r){var i=r.id==e?"selected":"";a("#universitas").append(`<option value="${r.id}" ${i}>${r.nama_mitra}</option>`)})}).fail(function(){alert("Gagal mengambil data tahun akademik. Pastikan API berjalan dengan benar.")})}function p(){a.ajax({url:"/admin/getbiodatamahasiswa",type:"GET",dataType:"json",success:function(e){const t=e.data;if(console.log("Data biodata mahasiswa diterima:",t),!t||!t.biodata_mahasiswa){console.warn("Data biodata mahasiswa tidak ditemukan:",t);return}const s=t.biodata_mahasiswa;a("#user_id").val(s.user_id),a("#nama").val(t.name),a("#nim").val(s.nim),a("#tempat_lahir").val(s.tempat_lahir),a("#tanggal_lahir").val(s.tanggal_lahir),a("#jenis_kelamin").val(s.jenis_kelamin),a("#alamat_ktp").val(s.alamat_ktp),a("#nik").val(s.nik),a("#no_wa").val(s.no_wa),a("#agama").val(s.agama??""),a("#status_pernikahan").val(s.status_pernikahan),a("#jumlah_saudara").val(s.jumlah_saudara),a("#anak_ke").val(s.anak_ke),s.foto?a("#fotoPreview").attr("src","/"+s.foto):a("#fotoPreview").attr("src","/img/default-avatar.jpg"),t.akademik&&g(t.akademik),t.orangtua&&_(t.orangtua),t.dokumen&&b(t.dokumen)},error:function(e,t,s){console.error("Gagal ambil data:",s,e.responseText)}})}const k=["#penghasilan_ibu","#penghasilan_ayah"];k.forEach(e=>{a(document).on("input",e,function(){let t=this.selectionStart,s=a(this).val(),r=s.replace(/[^0-9]/g,""),i=c(r);a(this).val(i);let n=i.length-s.length;this.setSelectionRange(t+n,t+n)})});function c(e){if(!e)return"";let t=e.length%3,s=e.substr(0,t),r=e.substr(t).match(/\d{3}/g);return r&&(s+=(t?".":"")+r.join(".")),"Rp "+s}function g(e){a("#fakultas").val(e.fakultas),a("#program_studi").val(e.program_studi),a("#semester").val(e.semester),a("#ip_terakhir").val(e.ip_terakhir),a("#tahun_akademik_id").val(e.tahun_akademik_id),d(e.tahun_akademik_id),h(e.mitra_id)}function _(e){a("#nama_ayah").val(e.nama_ayah),a("#pekerjaan_ayah").val(e.pekerjaan_ayah),a("#pendidikan_ayah").val(e.pendidikan_ayah),a("#penghasilan_ayah").val(c(e.penghasilan_ayah)),a("#nama_ibu").val(e.nama_ibu),a("#pekerjaan_ibu").val(e.pekerjaan_ibu),a("#pendidikan_ibu").val(e.pendidikan_ibu),a("#penghasilan_ibu").val(c(e.penghasilan_ibu)),a("#jumlah_tanggungan").val(e.jumlah_tanggungan),a("#no_wa_ortu").val(e.no_wa_ortu)}function b(e){m("#scan_ktp",e.scan_ktp),m("#scan_kartu_mahasiswa",e.scan_kartu_mahasiswa),m("#scan_kk",e.scan_kk),m("#transkrip_nilai",e.transkrip_nilai),m("#surat_keterangan_aktif",e.surat_keterangan_aktif),m("#foto_profil",e.foto_profil),m("#essay_motivasi",e.essay_motivasi),m("#sertifikat_prestasi",e.sertifikat_prestasi)}function m(e,t){const r=a(e).parent();if(r.find(".lihat-file-btn").remove(),t&&t.trim()!==""){const n=`
            <a href="${"/"+t}" target="_blank"
                class="lihat-file-btn inline-flex items-center px-2 py-1 mt-2 text-xs text-white bg-blue-primary rounded-lg hover:bg-blue-600">
                <i class="fas fa-eye mr-1"></i>Lihat File
            </a>
        `;r.append(n)}}function u(e,t="info"){const i=a(`
            <div class="notification flex items-center space-x-3 ${t==="success"?"bg-green-500":t==="error"?"bg-red-500":"bg-blue-500"} text-white px-6 py-4 rounded-xl shadow-lg transform translate-x-full opacity-0 transition-all duration-300 cursor-pointer">
            <i class="fas ${t==="success"?"fa-check-circle":t==="error"?"fa-exclamation-circle":"fa-info-circle"} text-lg"></i>
            <span class="font-medium">${e}</span>
            </div>
            `);a("#notificationWrapper").append(i),setTimeout(()=>{i.removeClass("translate-x-full opacity-0")},100);const n=setTimeout(()=>{i.addClass("translate-x-full opacity-0"),setTimeout(()=>i.remove(),300)},4e3);i.on("click",function(){clearTimeout(n),a(this).addClass("translate-x-full opacity-0"),setTimeout(()=>a(this).remove(),300)})}a("#biodataForm").on("submit",function(e){e.preventDefault();const t=a("#submit"),s=t.html();t.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);let r=new FormData(this);a.ajax({url:"/admin/biodatamahasiswa",type:"POST",data:r,processData:!1,contentType:!1,headers:{"X-HTTP-Method-Override":"PUT"},dataType:"json",success:function(i){u(i.message,i.status),t.html(s).prop("disabled",!1),p()},error:function(i){if(t.html(s).prop("disabled",!1),i.status===422&&i.responseJSON.errors){let n=i.responseJSON.errors,o=[];for(let l in n)n.hasOwnProperty(l)&&o.push(n[l].join(", "));u(o.join(" | "),"error")}else{let n=i.responseJSON&&i.responseJSON.message?i.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(n,"error")}}})});a("#ip_terakhir").on("input",function(){let e=a(this).val(),t=e.split(".");if(parseFloat(t[0])>4){a(this).val(4);return}e.indexOf(".")!==-1&&t[1].length>3&&a(this).val(t[0]+"."+t[1].slice(0,3))});a("#akademikForm").on("submit",function(e){e.preventDefault();const t=a("#submitakademik"),s=t.html();t.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const r=a(this).serialize();a.ajax({url:"/admin/akademikmahasiswa",type:"PUT",data:r,dataType:"json",success:function(i){u(i.message,i.status),t.html(s).prop("disabled",!1),p()},error:function(i){if(t.html(s).prop("disabled",!1),i.status===422&&i.responseJSON.errors){let n=i.responseJSON.errors,o=[];for(let l in n)n.hasOwnProperty(l)&&o.push(n[l].join(", "));u(o.join(" | "),"error")}else{let n=i.responseJSON&&i.responseJSON.message?i.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(n,"error")}}})});a("#orangtuaForm").on("submit",function(e){e.preventDefault();const t=a("#submitorangtua"),s=t.html();t.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const r={};a(".rupiah-input").each(function(){const n=a(this).val().replace(/[^0-9]/g,"");a(this).val(n||0)});const i=a(this).serialize();a(".rupiah-input").each(function(){a(this).val(r[this.id])}),a.ajax({url:"/admin/orangtuamahasiswa",type:"PUT",data:i,dataType:"json",success:function(n){u(n.message,n.status),t.html(s).prop("disabled",!1),p()},error:function(n){if(t.html(s).prop("disabled",!1),n.status===422&&n.responseJSON.errors){let o=n.responseJSON.errors,l=[];for(let f in o)o.hasOwnProperty(f)&&l.push(o[f].join(", "));u(l.join(" | "),"error")}else{let o=n.responseJSON&&n.responseJSON.message?n.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(o,"error")}}})});a('input[type="file"]').on("change",function(){const e=this.files[0],t=500*1024,s=a(this).closest(".space-y-2").find("label").text().trim(),r=a(this).next("div"),i=r.find(".file-name"),n=r.find(".btn-preview");if(e)if(e.size>t)u(`File "${s}" terlalu besar! Maksimal 500 KB.`,"error"),a(this).val(""),i.text("Pilih file...").removeClass("text-orange-600 font-bold"),n.addClass("hidden");else{u(`File "${s}" terpilih.`,"success"),i.text(e.name).addClass("text-orange-600 font-bold"),n.removeClass("hidden");const o=URL.createObjectURL(e);n.off("click").on("click",function(l){l.preventDefault(),l.stopPropagation(),window.open(o,"_blank")})}});a("#dokumenForm").on("submit",function(e){e.preventDefault();const t=a("#submitdokumen"),s=t.html();t.html('<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...').prop("disabled",!0);const r=new FormData(this);a.ajax({url:"/admin/dokumenmahasiswa",type:"POST",data:r,processData:!1,contentType:!1,success:function(i){u(i.message,i.status),t.html(s).prop("disabled",!1),p()},error:function(i){if(t.html(s).prop("disabled",!1),i.status===422&&i.responseJSON.errors){let n=i.responseJSON.errors,o=[];for(let l in n)n.hasOwnProperty(l)&&o.push(n[l].join(", "));u(o.join(" | "),"error")}else{let n=i.responseJSON&&i.responseJSON.message?i.responseJSON.message:"Terjadi kesalahan saat menyimpan data!";u(n,"error")}}})});a("#foto").on("change",function(){const e=this.files[0];if(!e)return;const t=new FileReader;t.onload=function(s){a("#fotoPreview").attr("src",s.target.result)},t.readAsDataURL(e)});
